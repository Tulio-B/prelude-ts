(()=>{"use strict";var t={7721:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/logo.png"},6693:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/crypt.png"},4843:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/dungeon.png"},3412:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/ice.png"},9330:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/overworld.png"},9575:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/start.png"},9763:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/temple.png"},3833:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/floors.png"},5305:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/font.png"},1827:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/gamepanel.png"},9194:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/items.png"},9616:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/sky.png"},4656:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/sprites.png"},6068:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"images/walls.png"},9618:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/altar.wav"},4503:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/bosskill.wav"},6907:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/click.wav"},7037:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/click2.wav"},9342:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/crumble.wav"},6568:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/cut.wav"},3309:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/death.wav"},7346:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/hit.wav"},58:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/hurt.wav"},3444:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/hurt2.wav"},2097:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/key.wav"},9569:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/kill.wav"},1969:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/ladder.wav"},4835:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/pickup.wav"},6232:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/potion.wav"},2569:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/roll.wav"},8084:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/shoot.wav"},8914:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/slide.wav"},4498:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/splash.wav"},4210:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/thud.wav"},8436:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});const i=s.p+"sounds/treasure.wav"},7278:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(o,h){function r(t){try{l(i.next(t))}catch(t){h(t)}}function n(t){try{l(i.throw(t))}catch(t){h(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,n)}l((i=i.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Art=void 0;const h=s(6656),r=o(s(3833)),n=o(s(5305)),l=o(s(9194)),a=o(s(7721)),c=o(s(1827)),d=o(s(9616)),u=o(s(4656)),p=o(s(6068));class f{static loadBitmap(t){return i(this,void 0,void 0,(function*(){const e=new Image,s=document.createElement("canvas").getContext("2d");e.src=t,yield e.decode(),s.drawImage(e,0,0);const i=new h.Bitmap(e.naturalWidth,e.naturalHeight),o=s.getImageData(0,0,e.naturalWidth,e.naturalHeight).data;for(let t=0;t<o.length;t+=4){i.pixels[t/4]=o[t]<<16|o[t+1]<<8|o[t+2];let e=(15&i.pixels[t/4])>>2;16711935===i.pixels[t/4]&&(e=-1),i.pixels[t/4]=e}return i}))}static getCol(t){let e=t>>16&255,s=t>>8&255,i=t>>0&255;return e=85*e/255,s=85*s/255,i=85*i/255,e<<16|s<<8|i}}e.Art=f,f.walls=new h.Bitmap(0,0),f.floors=new h.Bitmap(0,0),f.sprites=new h.Bitmap(0,0),f.font=new h.Bitmap(0,0),f.panel=new h.Bitmap(0,0),f.items=new h.Bitmap(0,0),f.sky=new h.Bitmap(0,0),f.logo=new h.Bitmap(0,0),f.loadBitmap(p.default).then((t=>f.walls=t)),f.loadBitmap(r.default).then((t=>f.floors=t)),f.loadBitmap(u.default).then((t=>f.sprites=t)),f.loadBitmap(n.default).then((t=>f.font=t)),f.loadBitmap(c.default).then((t=>f.panel=t)),f.loadBitmap(l.default).then((t=>f.items=t)),f.loadBitmap(d.default).then((t=>f.sky=t)),f.loadBitmap(a.default).then((t=>f.logo=t))},882:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BatBossEntity=void 0;const i=s(6656);class o extends i.EnemyEntity{constructor(t,e){super(t,e,32,i.Art.getCol(16776960)),this.x=t,this.z=e,this.health=5,this.r=.3,this.flying=!0}die(){i.Sound.bosskill().play(),this.level.addEntity(new i.KeyEntity(this.x,this.z))}tick(){if(super.tick(),0===i.EnemyEntity.random.nextInt(20)){const t=this.x+2*(Math.random()-.5),e=this.z+2*(Math.random()-.5),s=new i.BatEntity(t,e);s.level=this.level,s.x=-999,s.z=-999,s.isFree(t,e)&&this.level.addEntity(s)}}}e.BatBossEntity=o},9808:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BatEntity=void 0;const i=s(6656);class o extends i.EnemyEntity{constructor(t,e){super(t,e,32,i.Art.getCol(8545902)),this.x=t,this.z=e,this.health=2,this.r=.3,this.flying=!0}}e.BatEntity=o},4103:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BossOgre=void 0;const i=s(6656);class o extends i.EnemyEntity{constructor(t,e){super(t,e,34,i.Art.getCol(16776960)),this.shootDelay=0,this.shootPhase=0,this.x=t,this.z=e,this.health=10,this.r=.4,this.spinSpeed=.05}die(){i.Sound.bosskill().play(),this.level.addEntity(new i.KeyEntity(this.x,this.z))}tick(){if(super.tick(),this.shootDelay>0)this.shootDelay--;else{this.shootDelay=5;const t=10;for(let e=0;e<4;e++){const s=Math.PI/2*(e+this.shootPhase/t%2*.5);this.level.addEntity(new i.Bullet(this,this.x,this.z,s,.4,1,this.defaultColor))}this.shootPhase++,this.shootPhase%t==0&&(this.shootDelay=40)}}}e.BossOgre=o},4282:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BoulderEntity=void 0;const i=s(6656);class o extends i.Entity{constructor(t,e){super(),this.rollDist=0,this.x=t,this.z=e,this.sprite=new i.Sprite(0,0,0,16,o.COLOR),this.sprites.push(this.sprite)}tick(){this.rollDist+=Math.sqrt(this.xa*this.xa+this.za*this.za),this.sprite.tex=8+(1&Math.trunc(4*this.rollDist));const t=this.xa,e=this.za;this.move(),0===this.xa&&0!==t&&(this.xa=.3*-t),0===this.za&&0!==e&&(this.za=.3*-e),this.xa*=.98,this.za*=.98,this.xa*this.xa+this.za*this.za<1e-4&&(this.xa=0,this.za=0)}use(t,e){return e===i.Item.powerGlove&&(i.Sound.roll().play(),this.xa+=.1*Math.sin(t.rot),this.za+=.1*Math.cos(t.rot),!0)}}e.BoulderEntity=o,o.COLOR=i.Art.getCol(11510419)},654:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Bullet=void 0;const i=s(6656);class o extends i.Entity{constructor(t,e,s,o,h,r,n){super(),this.r=.01,this.owner=t,this.xa=.2*Math.sin(o)*h,this.za=.2*Math.cos(o)*h,this.x=e-this.za/2,this.z=s+this.xa/2,this.sprites.push(new i.Sprite(0,0,0,24+r,i.Art.getCol(n))),this.flying=!0}tick(){const t=this.xa,e=this.za;this.move(),(0===this.xa&&0===this.za||this.xa!==t||this.za!==e)&&this.remove()}blocks(t,e,s,i){return!(t instanceof o)&&t!==this.owner&&super.blocks(t,e,s,i)}}e.Bullet=o},2110:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EnemyEntity=void 0;const i=s(6656);class o extends i.Entity{constructor(t,e,s,o){super(),this.hurtTime=0,this.animTime=0,this.health=3,this.spinSpeed=.1,this.runSpeed=1,this.x=t,this.z=e,this.defaultColor=o,this.defaultTex=s,this.sprite=new i.Sprite(0,0,0,32,o),this.sprites.push(this.sprite),this.r=.3}tick(){this.hurtTime>0&&(this.hurtTime--,0===this.hurtTime&&(this.sprite.col=this.defaultColor)),this.animTime++,this.sprite.tex=this.defaultTex+Math.trunc(this.animTime/10)%2,this.move(),0!==this.xa&&0!==this.za||(this.rota+=o.random.nextGaussian()*Math.random()*.3),this.rota+=o.random.nextGaussian()*Math.random()*this.spinSpeed,this.rot+=this.rota,this.rota*=.8,this.xa*=.8,this.za*=.8,this.xa+=.004*Math.sin(this.rot)*this.runSpeed,this.za+=.004*Math.cos(this.rot)*this.runSpeed}use(t,e){return!(this.hurtTime>0||e!==i.Item.powerGlove||(this.hurt(Math.sin(t.rot),Math.cos(t.rot)),0))}hurt(t,e){this.sprite.col=i.Art.getCol(16711680),this.hurtTime=15;const s=Math.sqrt(t*t+e*e);if(this.xa+=t/s*.2,this.za+=e/s*.2,i.Sound.hurt2().play(),this.health--,this.health<=0){const t=Math.trunc(this.x+.5),e=Math.trunc(this.z+.5);this.level.getBlock(t,e).addSprite(new i.PoofSprite(this.x-t,0,this.z-e)),this.die(),this.remove(),i.Sound.kill().play()}}die(){}collide(t){if(t instanceof i.Bullet){if(t.owner.constructor===this.constructor)return;if(this.hurtTime>0)return;t.remove(),this.hurt(t.xa,t.za)}t instanceof i.Player&&t.hurt(this,1)}}e.EnemyEntity=o},4664:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Entity=void 0;const i=s(9963);class o{constructor(){this.sprites=[],this.x=0,this.z=0,this.rot=0,this.xa=0,this.za=0,this.rota=0,this.r=.4,this.xTileO=-1,this.zTileO=-1,this.flying=!1,this.removed=!1}updatePos(){const t=Math.trunc(this.x+.5),e=Math.trunc(this.z+.5);t===this.xTileO&&e===this.zTileO||(this.level.getBlock(this.xTileO,this.zTileO).removeEntity(this),this.xTileO=t,this.zTileO=e,this.removed||this.level.getBlock(this.xTileO,this.zTileO).addEntity(this))}isRemoved(){return this.removed}remove(){this.level.getBlock(this.xTileO,this.zTileO).removeEntity(this),this.removed=!0}move(){const t=Math.trunc(Math.abs(100*this.xa)+1);for(let e=t;e>0;e--){const s=this.xa;if(this.isFree(this.x+s*e/t,this.z)){this.x+=s*e/t;break}this.xa=0}const e=Math.trunc(Math.abs(100*this.za)+1);for(let t=e;t>0;t--){const s=this.za;if(this.isFree(this.x,this.z+s*t/e)){this.z+=s*t/e;break}this.za=0}}isFree(t,e){const s=Math.trunc(Math.floor(t+.5-this.r)),i=Math.trunc(Math.floor(t+.5+this.r)),o=Math.trunc(Math.floor(e+.5-this.r)),h=Math.trunc(Math.floor(e+.5+this.r));if(this.level.getBlock(s,o).blocks(this))return!1;if(this.level.getBlock(i,o).blocks(this))return!1;if(this.level.getBlock(s,h).blocks(this))return!1;if(this.level.getBlock(i,h).blocks(this))return!1;const r=Math.trunc(Math.floor(t+.5)),n=Math.trunc(Math.floor(e+.5));for(let s=n-2;s<=n+2;s++)for(let i=r-2;i<=r+2;i++){const o=this.level.getBlock(i,s).entities;for(let s=0;s<o.length;s++){const i=o[s];if(i!==this&&!i.blocks(this,this.x,this.z,this.r)&&i.blocks(this,t,e,this.r))return i.collide(this),this.collide(i),!1}}return!0}collide(t){}blocks(t,e,s,i){return!(this.x+this.r<=e-i||this.x-this.r>=e+i||this.z+this.r<=s-i||this.z-this.r>=s+i)}contains(t,e){return!(this.x+this.r<=t||this.x-this.r>=t||this.z+this.r<=e||this.z-this.r>=e)}isInside(t,e,s,i){return!(this.x+this.r<=t||this.x-this.r>=s||this.z+this.r<=e||this.z-this.r>=i)}use(t,e){return!1}tick(){}}e.Entity=o,o.random=new i.Random(123)},7460:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EyeBossEntity=void 0;const i=s(6656);class o extends i.EnemyEntity{constructor(t,e){super(t,e,36,i.Art.getCol(16776960)),this.x=t,this.z=e,this.health=10,this.r=.3,this.runSpeed=4,this.spinSpeed*=1.5,this.flying=!0}die(){i.Sound.bosskill().play(),this.level.addEntity(new i.KeyEntity(this.x,this.z))}}e.EyeBossEntity=o},6421:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EyeEntity=void 0;const i=s(6656);class o extends i.EnemyEntity{constructor(t,e){super(t,e,36,i.Art.getCol(8711423)),this.x=t,this.z=e,this.health=4,this.r=.3,this.runSpeed=2,this.spinSpeed*=1.5,this.flying=!0}}e.EyeEntity=o},8642:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GhostBossEntity=void 0;const i=s(6656);class o extends i.EnemyEntity{constructor(t,e){super(t,e,38,i.Art.getCol(16776960)),this.rotatePos=0,this.shootDelay=0,this.x=t,this.z=e,this.health=10,this.flying=!0}tick(){this.animTime++,this.sprite.tex=this.defaultTex+Math.trunc(this.animTime/10)%2;let t=this.level.player.x+2*Math.sin(this.rotatePos)-this.x,e=this.level.player.z+2*Math.cos(this.rotatePos)-this.z,s=t*t+e*e;s<1?this.rotatePos+=.04:this.rotatePos=this.level.player.rot,s<16&&(s=Math.sqrt(s),t/=s,e/=s,this.xa+=.006*t,this.za+=.006*e,this.shootDelay>0?this.shootDelay--:0===i.Entity.random.nextInt(10)&&(this.shootDelay=10,this.level.addEntity(new i.Bullet(this,this.x,this.z,Math.atan2(this.level.player.x-this.x,this.level.player.z-this.z),.2,1,this.defaultColor)))),this.move(),this.xa*=.9,this.za*=.9}hurt(t,e){}move(){this.x+=this.xa,this.z+=this.za}}e.GhostBossEntity=o},913:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GhostEntity=void 0;const i=s(6656);class o extends i.EnemyEntity{constructor(t,e){super(t,e,38,i.Art.getCol(16777215)),this.rotatePos=0,this.x=t,this.z=e,this.health=4,this.r=.3,this.flying=!0}tick(){this.animTime++,this.sprite.tex=this.defaultTex+Math.trunc(this.animTime/10)%2;let t=this.level.player.x+Math.sin(this.rotatePos)-this.x,e=this.level.player.z+Math.cos(this.rotatePos)-this.z,s=t*t+e*e;s<16&&(s<1?this.rotatePos+=.04:(this.rotatePos=this.level.player.rot,this.xa+=.02*(Math.random()-.5),this.za+=.02*(Math.random()-.5)),s=Math.sqrt(s),t/=s,e/=s,this.xa+=.004*t,this.za+=.004*e),this.move(),this.xa*=.9,this.za*=.9}hurt(t,e){}move(){this.x+=this.xa,this.z+=this.za}}e.GhostEntity=o},2202:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Item=void 0;class s{constructor(t,e,s,i){this.icon=t,this.color=e,this.name=s,this.description=i}}e.Item=s,s.none=new s(-1,16761699,"",""),s.powerGlove=new s(0,16761699,"Power Glove","Smaaaash!!"),s.pistol=new s(1,15395562,"Pistol","Pew, pew, pew!"),s.flippers=new s(2,8174591,"Flippers","Splish splash!"),s.cutters=new s(3,13421772,"Cutters","Snip, snip!"),s.skates=new s(4,11432191,"Skates","Sharp!"),s.key=new s(5,16728128,"Key","How did you get this?"),s.potion=new s(6,4915015,"Potion","Healthy!")},9317:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KeyEntity=void 0;const i=s(6656);class o extends i.Entity{constructor(t,e){super(),this.x=t,this.z=e,this.y=.5,this.ya=.025,this.sprite=new i.Sprite(0,0,0,19,o.COLOR),this.sprites.push(this.sprite)}tick(){this.move(),this.y+=this.ya,this.y<0&&(this.y=0),this.ya-=.005,this.sprite.y=this.y}collide(t){t instanceof i.Player&&(i.Sound.key().play(),t.keys++,this.remove())}}e.KeyEntity=o,o.COLOR=i.Art.getCol(65535)},1110:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OgreEntity=void 0;const i=s(6656);class o extends i.EnemyEntity{constructor(t,e){super(t,e,34,i.Art.getCol(8562721)),this.x=t,this.z=e,this.health=6,this.r=.4,this.spinSpeed=.05}hurt(t,e){super.hurt(t,e),this.shootDelay=50}tick(){super.tick(),this.shootDelay>0?this.shootDelay--:0===i.EnemyEntity.random.nextInt(40)&&(this.shootDelay=40,this.level.addEntity(new i.Bullet(this,this.x,this.z,Math.atan2(this.level.player.x-this.x,this.level.player.z-this.z),.3,1,this.defaultColor)))}}e.OgreEntity=o},3308:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;const i=s(6656);class o extends i.Entity{constructor(){super(),this.bob=0,this.bobPhase=0,this.turnBob=0,this.selectedSlot=0,this.itemUseTime=0,this.y=0,this.ya=0,this.hurtTime=0,this.health=20,this.keys=0,this.loot=0,this.dead=!1,this.deadTime=0,this.ammo=0,this.potions=0,this.items=new Array(8),this.sliding=!1,this.time=0,this.r=.3;for(let t=0;t<this.items.length;t++)this.items[t]=i.Item.none}tick(t,e,s,o,h,r){this.dead?(t=!1,e=!1,s=!1,o=!1,h=!1,r=!1,this.deadTime++,this.deadTime>120&&this.level.lose()):this.time++,this.itemUseTime>0&&this.itemUseTime--,this.hurtTime>0&&this.hurtTime--;const n=this.level.getBlock(Math.trunc(this.x+.5),Math.trunc(this.z+.5));let l=n.getFloorHeight(this);n instanceof i.WaterBlock&&!(this.lastBlock instanceof i.WaterBlock)&&i.Sound.splash().play(),this.lastBlock=n,this.dead&&(l=-.6),l>this.y?(this.y+=.2*(l-this.y),this.ya=0):(this.ya-=.01,this.y+=this.ya,this.y<l&&(this.y=l,this.ya=0));const a=.03*n.getWalkSpeed(this);h&&(this.rota+=.05),r&&(this.rota-=.05);let c=0,d=0;t&&d--,e&&d++,s&&c--,o&&c++;let u=c*c+d*d;u=u>0?Math.sqrt(u):1,c/=u,d/=u,this.bob*=.6,this.turnBob*=.8,this.turnBob+=this.rota,this.bob+=Math.sqrt(c*c+d*d),this.bobPhase+=Math.sqrt(c*c+d*d)*n.getWalkSpeed(this);const p=this.sliding;this.sliding=!1,n instanceof i.IceBlock&&this.getSelectedItem()!==i.Item.skates?(this.xa*this.xa>this.za*this.za?(this.sliding=!0,this.za=0,this.xa>0?this.xa=.08:this.xa=-.08,this.z+=.2*(Math.trunc(this.z+.5)-this.z)):this.xa*this.xa<this.za*this.za?(this.sliding=!0,this.xa=0,this.za>0?this.za=.08:this.za=-.08,this.x+=.2*(Math.trunc(this.x+.5)-this.x)):(this.xa-=.1*(c*Math.cos(this.rot)+d*Math.sin(this.rot)),this.za-=.1*(d*Math.cos(this.rot)-c*Math.sin(this.rot))),!p&&this.sliding&&i.Sound.slide().play()):(this.xa-=(c*Math.cos(this.rot)+d*Math.sin(this.rot))*a,this.za-=(d*Math.cos(this.rot)-c*Math.sin(this.rot))*a),this.move();const f=n.getFriction(this);this.xa*=f,this.za*=f,this.rot+=this.rota,this.rota*=.4}activate(){if(this.dead)return;if(this.itemUseTime>0)return;const t=this.items[this.selectedSlot];if(t===i.Item.pistol)return void(this.ammo>0&&(i.Sound.shoot().play(),this.itemUseTime=10,this.level.addEntity(new i.Bullet(this,this.x,this.z,this.rot,1,0,16777215)),this.ammo--));if(t===i.Item.potion)return void(this.potions>0&&this.health<20&&(i.Sound.potion().play(),this.itemUseTime=20,this.health+=5+i.Entity.random.nextInt(6),this.health>20&&(this.health=20),this.potions--));t===i.Item.key&&(this.itemUseTime=10),t===i.Item.powerGlove&&(this.itemUseTime=10),t===i.Item.cutters&&(this.itemUseTime=10);const e=2*Math.sin(this.rot),s=2*Math.cos(this.rot),o=Math.trunc(this.x+.5),h=Math.trunc(this.z+.5),r=[];for(let t=h-3;t<=h+3;t++)for(let e=o-3;e<=o+3;e++){const s=this.level.getBlock(e,t).entities;for(let t=0;t<s.length;t++){const e=s[t];e!==this&&r.push(e)}}for(let t=0;t<100;t++){const i=this.x+e*t/100,o=this.z+s*t/100;for(let t=0;t<r.length;t++){const e=r[t];if(e.contains(i,o)&&e.use(this,this.items[this.selectedSlot]))return}const h=Math.trunc(i+.5),n=Math.trunc(o+.5);if(h!==Math.trunc(this.x+.5)||n!==Math.trunc(this.z+.5)){const t=this.level.getBlock(h,n);if(t.use(this.level,this.items[this.selectedSlot]))return;if(t.blocks(this))return}}}blocks(t,e,s,i){return super.blocks(t,e,s,i)}getSelectedItem(){return this.items[this.selectedSlot]}addLoot(t){t===i.Item.pistol&&(this.ammo+=20),t===i.Item.potion&&(this.potions+=1);for(let e=0;e<this.items.length;e++)if(this.items[e]===t)return void(null!==this.level&&this.level.showLootScreen(t));for(let e=0;e<this.items.length;e++)if(this.items[e]===i.Item.none)return this.items[e]=t,this.selectedSlot=e,this.itemUseTime=0,void(null!==this.level&&this.level.showLootScreen(t))}hurt(t,e){if(this.hurtTime>0||this.dead)return;this.hurtTime=40,this.health-=e,this.health<=0&&(this.health=0,i.Sound.death().play(),this.dead=!0),i.Sound.hurt().play();const s=t.x-this.x,o=t.z-this.z,h=Math.sqrt(s*s+o*o);this.xa-=s/h*.1,this.za-=o/h*.1,this.rota+=.2*(Math.random()-.5)}collide(t){if(t instanceof i.Bullet){if(t.owner.constructor===this.constructor)return;if(this.hurtTime>0)return;t.remove(),this.hurt(t,1)}}win(){this.level.win()}}e.Player=o},7769:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;const i=s(6656);e.Game=class{constructor(){this.setMenu(new i.TitleMenu)}newGame(){i.Level.clear(),this.level=i.Level.loadLevel(this,"start"),this.player=new i.Player,this.player.level=this.level,this.level.player=this.player,this.player.x=this.level.xSpawn,this.player.z=this.level.ySpawn,this.level.addEntity(this.player),this.player.rot=Math.PI+.4}switchLevel(t,e){this.pauseTime=30,this.level.removeEntityImmediately(this.player),this.level=i.Level.loadLevel(this,t),this.level.findSpawn(e),this.player.x=this.level.xSpawn,this.player.z=this.level.ySpawn,this.level.getBlock(this.level.xSpawn,this.level.ySpawn).wait=!0,this.player.x+=.2*Math.sin(this.player.rot),this.player.z+=.2*Math.sin(this.player.rot),this.level.addEntity(this.player)}tick(t){if(this.pauseTime>0)return void this.pauseTime--;this.time++;const e=t[17]||t[18]||t[16],s=t[37]||t[100],o=t[39]||t[102],h=t[87]||t[38]||t[104],r=t[83]||t[40]||t[98],n=t[65]||e&&s,l=t[68]||e&&o,a=t[81]||!e&&s,c=t[69]||!e&&o,d=t[32];for(let e=0;e<8;e++)t[49+e]&&(t[49+e]=!1,this.player.selectedSlot=e,this.player.itemUseTime=0);t[27]&&(t[27]=!1,null===this.menu&&this.setMenu(new i.PauseMenu)),d&&(t[32]=!1),null===this.menu?(this.player.tick(h,r,n,l,a,c),d&&this.player.activate(),this.level.tick()):(t[87]=!1,t[38]=!1,t[104]=!1,t[83]=!1,t[40]=!1,t[98]=!1,t[65]=!1,t[68]=!1,this.menu.tick(this,h,r,n,l,d))}getLoot(t){this.player.addLoot(t)}win(t){this.setMenu(new i.WinMenu(t))}lose(t){this.setMenu(new i.LoseMenu(t))}setMenu(t){this.menu=t}}},3588:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Bitmap=void 0;const i=s(6656);class o{constructor(t,e){this.width=t,this.height=e,this.pixels=new Array(t*e)}draw(t,e,s,i,o,h,r,n){if(i>=0)for(let l=0;l<r;l++){const r=l+s;if(!(r<0||r>=this.height))for(let s=0;s<h;s++){const h=s+e;if(h<0||h>=this.width)continue;const a=t.pixels[s+i+(l+o)*t.width];a>=0&&(this.pixels[h+r*this.width]=a*n)}}else for(let i=0;i<t.height;i++){const o=i+s;if(!(o<0||o>=this.height))for(let s=0;s<t.width;s++){const h=s+e;if(h<0||h>=this.width)continue;const r=t.pixels[s+i*t.width];this.pixels[h+o*this.width]=r}}}flipDraw(t,e,s){for(let i=0;i<t.height;i++){const o=i+s;if(!(o<0||o>=this.height))for(let s=0;s<t.width;s++){const h=e+t.width-s-1;if(h<0||h>=this.width)continue;const r=t.pixels[s+i*t.width];this.pixels[h+o*this.width]=r}}}scaleDraw(t,e,s,i,o,h,r,n,l){for(let a=0;a<n*e;a++){const n=a+i;if(!(n<0||n>=this.height))for(let i=0;i<r*e;i++){const r=i+s;if(r<0||r>=this.width)continue;const c=t.pixels[Math.trunc(i/e+o)+Math.trunc(a/e+h)*t.width];c>=0&&(this.pixels[r+n*this.width]=c*l)}}}drawString(t,e,s,h){for(let r=0;r<t.length;r++){const n=o.chars.indexOf(t.charAt(r));if(n<0)continue;const l=n%42,a=Math.trunc(n/42);this.draw(i.Art.font,e+6*r,s,6*l,8*a,5,8,h)}}fill(t,e,s,i,o){for(let h=e;h<i;h++)for(let e=t;e<s;e++)this.pixels[e+h*this.width]=o}}e.Bitmap=o,o.chars=String("ABCDEFGHIJKLMNOPQRSTUVWXYZ.,!?\"'/\\<>()[]{}abcdefghijklmnopqrstuvwxyz_               0123456789+-=*:;ÖÅÄå                      ")},2623:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Bitmap3D=void 0;const i=s(6656);class o extends i.Bitmap{constructor(t,e){super(t,e),this.xCam=0,this.yCam=0,this.zCam=0,this.rCos=0,this.rSin=0,this.fov=0,this.xCenter=0,this.yCenter=0,this.rot=0,this.zBuffer=new Array(t*e),this.zBufferWall=new Array(t)}render(t){for(let t=0;t<this.width;t++)this.zBufferWall[t]=0;for(let t=0;t<this.width*this.height;t++)this.zBuffer[t]=1e4;this.rot=t.player.rot,this.xCam=t.player.x-.3*Math.sin(this.rot),this.yCam=t.player.z-.3*Math.cos(this.rot),this.zCam=.01*Math.sin(.4*t.player.bobPhase)*t.player.bob-.2-t.player.y,this.xCenter=this.width/2,this.yCenter=this.height/3,this.rCos=Math.cos(this.rot),this.rSin=Math.sin(this.rot),this.fov=this.height;const e=t.level,s=Math.floor(this.xCam),o=Math.floor(this.yCam);for(let t=o-6;t<=o+6;t++)for(let o=s-6;o<=s+6;o++){const s=e.getBlock(o,t),h=e.getBlock(o+1,t),r=e.getBlock(o,t+1);if(s instanceof i.DoorBlock){const e=1/8,i=1-s.openness*(7/8);h.solidRender?(this.renderWall(o+i,t+.5-e,o,t+.5-e,s.tex,(16711422&s.col)>>1,0,i),this.renderWall(o,t+.5+e,o+i,t+.5+e,s.tex,(16711422&s.col)>>1,i,0),this.renderWall(o+i,t+.5+e,o+i,t+.5-e,s.tex,s.col,.5-e,.5+e)):(this.renderWall(o+.5-e,t,o+.5-e,t+i,s.tex,s.col,i,0),this.renderWall(o+.5+e,t+i,o+.5+e,t,s.tex,s.col,0,i),this.renderWall(o+.5-e,t+i,o+.5+e,t+i,s.tex,(16711422&s.col)>>1,.5-e,.5+e))}s.solidRender?(h.solidRender||this.renderWall(o+1,t+1,o+1,t,s.tex,s.col),r.solidRender||this.renderWall(o,t+1,o+1,t+1,s.tex,(16711422&s.col)>>1)):(h.solidRender&&this.renderWall(o+1,t,o+1,t+1,h.tex,h.col),r.solidRender&&this.renderWall(o+1,t+1,o,t+1,r.tex,(16711422&r.col)>>1))}for(let t=o-6;t<=o+6;t++)for(let i=s-6;i<=s+6;i++){const s=e.getBlock(i,t);for(let t=0;t<s.entities.length;t++){const e=s.entities[t];for(let t=0;t<e.sprites.length;t++){const s=e.sprites[t];this.renderSprite(e.x+s.x,0-s.y,e.z+s.z,s.tex,s.col)}}for(let e=0;e<s.sprites.length;e++){const o=s.sprites[e];this.renderSprite(i+o.x,0-o.y,t+o.z,o.tex,o.col)}}this.renderFloor(e)}renderFloor(t){for(let e=0;e<this.height;e++){const s=(e+.5-this.yCenter)/this.fov;let o=!0,h=(4-8*this.zCam)/s;s<0&&(o=!1,h=(4+8*this.zCam)/-s);for(let s=0;s<this.width;s++){if(this.zBuffer[s+e*this.width]<=h)continue;let r=(this.xCenter-s)/this.fov;r*=h;const n=r*this.rCos+h*this.rSin+8*(this.xCam+.5),l=h*this.rCos-r*this.rSin+8*(this.yCam+.5),a=Math.trunc(2*n),c=Math.trunc(2*l),d=a>>4,u=c>>4,p=t.getBlock(d,u);let f=p.floorCol,y=p.floorTex;o||(f=p.ceilCol,y=p.ceilTex),y<0?this.zBuffer[s+e*this.width]=-1:(this.zBuffer[s+e*this.width]=h,this.pixels[s+e*this.width]=i.Art.floors.pixels[(15&a)+y%8*16+128*((15&c)+16*Math.trunc(y/8))]*f)}}}renderSprite(t,e,s,o,h){const r=2*(t-this.xCam)-.2*this.rSin,n=2*(e-this.zCam),l=2*(s-this.yCam)-.2*this.rCos,a=r*this.rCos-l*this.rSin,c=n;let d=l*this.rCos+r*this.rSin;if(d<.1)return;const u=this.xCenter-a/d*this.fov,p=c/d*this.fov+this.yCenter,f=u-this.height/d,y=u+this.height/d,g=p-this.height/d,m=p+this.height/d;let w=Math.trunc(Math.ceil(f)),v=Math.trunc(Math.ceil(y)),k=Math.trunc(Math.ceil(g)),x=Math.trunc(Math.ceil(m));w<0&&(w=0),v>this.width&&(v=this.width),k<0&&(k=0),x>this.height&&(x=this.height),d*=4;for(let t=k;t<x;t++){const e=(t-g)/(m-g),s=Math.trunc(16*e);for(let e=w;e<v;e++){const r=(e-f)/(y-f),n=Math.trunc(16*r);if(this.zBuffer[e+t*this.width]>d){const r=i.Art.sprites.pixels[n+o%8*16+128*(s+16*Math.trunc(o/8))];r>=0&&(this.pixels[e+t*this.width]=r*h,this.zBuffer[e+t*this.width]=d)}}}}renderWall(t,e,s,o,h,r,n=0,l=1){const a=2*(t-.5-this.xCam),c=2*(e-.5-this.yCam);let d=a*this.rCos-c*this.rSin;const u=2*(-.5-this.zCam),p=2*(.5-this.zCam);let f=c*this.rCos+a*this.rSin;const y=2*(s-.5-this.xCam),g=2*(o-.5-this.yCam);let m=y*this.rCos-g*this.rSin;const w=2*(-.5-this.zCam),v=2*(.5-this.zCam);let k=g*this.rCos+y*this.rSin;n*=16,l*=16;const x=.2;if(f<x&&k<x)return;if(f<x){const t=(x-f)/(k-f);f+=(k-f)*t,d+=(m-d)*t,n+=(l-n)*t}if(k<x){const t=(x-f)/(k-f);k=f+(k-f)*t,m=d+(m-d)*t,l=n+(l-n)*t}const M=this.xCenter-d/f*this.fov,B=this.xCenter-m/k*this.fov;if(M>=B)return;let S=Math.trunc(Math.ceil(M)),b=Math.trunc(Math.ceil(B));S<0&&(S=0),b>this.width&&(b=this.width);const C=u/f*this.fov+this.yCenter,_=p/f*this.fov+this.yCenter,E=w/k*this.fov+this.yCenter,P=v/k*this.fov+this.yCenter,z=1/f,T=1/k,A=T-z,L=n*z,O=l*T-L,I=1/(B-M);for(let t=S;t<b;t++){const e=(t-M)*I,s=z+A*e;if(this.zBufferWall[t]>s)continue;this.zBufferWall[t]=s;const o=Math.trunc((L+O*e)/s),n=C+(E-C)*e-.5,l=_+(P-_)*e;let a=Math.trunc(Math.ceil(n)),c=Math.trunc(Math.ceil(l));a<0&&(a=0),c>this.height&&(c=this.height);const d=1/(l-n);for(let e=a;e<c;e++){const l=(e-n)*d,a=Math.trunc(16*l);this.pixels[t+e*this.width]=i.Art.walls.pixels[o+h%8*16+128*(a+16*Math.trunc(h/8))]*r,this.zBuffer[t+e*this.width]=1/s*4}}}postProcess(){for(let t=0;t<this.width*this.height;t++){const e=this.zBuffer[t];if(e<0){const e=511&Math.trunc(Math.floor(t%this.width-512*this.rot/(2*Math.PI))),s=t/this.width;this.pixels[t]=4473941*i.Art.sky.pixels[e+512*s]}else{const s=t%this.width,i=t/this.width*14,o=(t%this.width-this.width/2)/this.width,h=this.pixels[t];let r=Math.trunc(300-6*e*(o*o*2+1));r=r+4*(s+i&3)>>4<<4,r<0&&(r=0),r>255&&(r=255);let n=h>>16&255,l=h>>8&255,a=255&h;n=n*r/255,l=l*r/255,a=a*r/255,this.pixels[t]=n<<16|l<<8|a}}}}e.Bitmap3D=o},4848:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PoofSprite=void 0;const i=s(6656);class o extends i.Sprite{constructor(t,e,s){super(t,e,s,5,2236962),this.life=20}tick(){this.life--<=0&&(this.removed=!0)}}e.PoofSprite=o},1120:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RubbleSprite=void 0;const i=s(6656);class o extends i.Sprite{constructor(){super(Math.random()-.5,.8*Math.random(),Math.random()-.5,2,5592405),this.xa=Math.random()-.5,this.ya=Math.random(),this.za=Math.random()-.5}tick(){this.x+=.03*this.xa,this.y+=.03*this.ya,this.z+=.03*this.za,this.ya-=.1,this.y<0&&(this.y=0,this.xa*=.8,this.za*=.8,Math.random()<.04&&(this.removed=!0))}}e.RubbleSprite=o},548:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Screen=void 0;const i=s(6656);class o extends i.Bitmap{constructor(t,e){super(t,e),this.time=0,this.viewport=new i.Bitmap3D(t,e-o.PANEL_HEIGHT),this.testBitmap=new i.Bitmap(64,64);const s=new i.Random;for(let t=0;t<4096;t++)this.testBitmap.pixels[t]=s.nextInt()*(s.nextInt(5)/4)}render(t,e){if(t.level){const s=t.player.itemUseTime>0,h=t.player.items[t.player.selectedSlot];if(t.pauseTime>0){this.fill(0,0,this.width,this.height,0);const e=[`Entering ${t.level.name}`];for(let t=0;t<e.length;t++)this.drawString(e[t],Math.trunc((this.width-6*e[t].length)/2),Math.trunc((this.viewport.height-8*e.length)/2)+8*t+1,1118481),this.drawString(e[t],Math.trunc((this.width-6*e[t].length)/2),Math.trunc((this.viewport.height-8*e.length)/2)+8*t,5592388)}else{this.viewport.render(t),this.viewport.postProcess();const r=t.level.getBlock(Math.trunc(t.player.x+.5),Math.trunc(t.player.z+.5));if(void 0!==r.messages&&e)for(let t=0;t<r.messages.length;t++)this.viewport.drawString(r.messages[t],Math.trunc((this.width-6*r.messages[t].length)/2),Math.trunc((this.viewport.height-8*r.messages.length)/2)+8*t+1,1118481),this.viewport.drawString(r.messages[t],Math.trunc((this.width-6*r.messages[t].length)/2),Math.trunc((this.viewport.height-8*r.messages.length)/2)+8*t,5592388);this.draw(this.viewport,0,0);let n=Math.trunc(32*t.player.turnBob),l=Math.trunc(Number(Math.sin(.4*t.player.bobPhase))*t.player.bob+2*t.player.bob);if(s&&(n=0,l=0),n+=this.width/2,l+=this.height-o.PANEL_HEIGHT-45,h!==i.Item.none&&this.scaleDraw(i.Art.items,3,n,l,16*h.icon+1,17+(s?16:0),15,15,i.Art.getCol(h.color)),t.player.hurtTime>0||t.player.dead){let e=1.5-t.player.hurtTime/30;const s=new i.Random(111);t.player.dead&&(e=.5);for(let t=0;t<this.pixels.length;t++){const i=(t%this.width-this.viewport.width/2)/this.width*2,o=(t/this.width-this.viewport.height/2)/this.viewport.height*2;Math.random()+e<Math.sqrt(i*i+o*o)&&(this.pixels[t]=5570560*Math.trunc(s.nextInt(5)/4))}}}this.draw(i.Art.panel,0,this.height-o.PANEL_HEIGHT,0,0,this.width,o.PANEL_HEIGHT,i.Art.getCol(7368816)),this.drawString("å",3,this.height-26+0,65535),this.drawString(`${t.player.keys}/4`,10,this.height-26+0,16777215),this.drawString("Ä",3,this.height-26+8,16776960),this.drawString(String(t.player.loot),10,this.height-26+8,16777215),this.drawString("Å",3,this.height-26+16,16711680),this.drawString(String(t.player.health),10,this.height-26+16,16777215);for(let e=0;e<8;e++){const s=t.player.items[e];if(s!==i.Item.none){if(this.draw(i.Art.items,30+16*e,this.height-o.PANEL_HEIGHT+2,16*s.icon,0,16,16,i.Art.getCol(s.color)),s===i.Item.pistol){const s=String(t.player.ammo);this.drawString(s,30+16*e+17-6*s.length,this.height-o.PANEL_HEIGHT+1+10,5592405)}if(s===i.Item.potion){const s=String(t.player.potions);this.drawString(s,30+16*e+17-6*s.length,this.height-o.PANEL_HEIGHT+1+10,5592405)}}}this.draw(i.Art.items,30+16*t.player.selectedSlot,this.height-o.PANEL_HEIGHT+2,0,48,17,17,i.Art.getCol(16777215)),this.drawString(h.name,26+(128-4*h.name.length)/2,this.height-9,16777215)}else this.fill(0,0,this.width,this.height,0);if(null!==t.menu){for(let t=0;t<this.pixels.length;t++)this.pixels[t]=(16579836&this.pixels[t])>>2;t.menu.render(this)}if(!e){for(let t=0;t<this.pixels.length;t++)this.pixels[t]=(16579836&this.pixels[t])>>2;if(0!==Math.trunc(Date.now()/450%2)){const t="Click to focus!";this.drawString(t,(this.width-6*t.length)/2,this.height/3+4,16777215)}}}}e.Screen=o,o.PANEL_HEIGHT=29},1814:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0,e.Sprite=class{constructor(t,e,s,i,o){this.col=2105376,this.removed=!1,this.x=t,this.y=e,this.z=s,this.tex=i,this.col=o}tick(){}}},5717:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InputHandler=void 0,e.InputHandler=class{constructor(){this.keys=new Array(65536),document.addEventListener("keydown",(t=>{const e=t.keyCode;e>0&&e<this.keys.length&&(this.keys[e]=!0)}),!1),document.addEventListener("keyup",(t=>{const e=t.keyCode;e>0&&e<this.keys.length&&(this.keys[e]=!1)}),!1)}}},8711:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AltarBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.filled=!1,this.blocksMotion=!0,this.sprite=new i.Sprite(0,0,0,20,i.Art.getCol(14876644)),this.addSprite(this.sprite)}addEntity(t){if(super.addEntity(t),!this.filled&&(t instanceof i.GhostEntity||t instanceof i.GhostBossEntity)){t.remove(),this.filled=!0,this.blocksMotion=!1,this.sprite.removed=!0;for(let t=0;t<8;t++){const t=new i.RubbleSprite;t.col=this.sprite.col,this.addSprite(t)}t instanceof i.GhostBossEntity?(this.level.addEntity(new i.KeyEntity(this.x,this.y)),i.Sound.bosskill().play()):i.Sound.altar().play()}}blocks(t){return this.blocksMotion}}e.AltarBlock=o},5286:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BarsBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.open=!1,this.sprite=new i.Sprite(0,0,0,0,2105376),this.addSprite(this.sprite),this.blocksMotion=!0}use(t,e){return!this.open&&(e===i.Item.cutters&&(i.Sound.cut().play(),this.sprite.tex=1,this.open=!0),!0)}blocks(t){return!(this.open&&t instanceof i.Player)&&!(this.open&&t instanceof i.Bullet)&&this.blocksMotion}}e.BarsBlock=o},2732:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Block=void 0;const i=s(6656);class o{constructor(){this.blocksMotion=!1,this.solidRender=!1,this.sprites=[],this.entities=[],this.tex=-1,this.col=-1,this.floorCol=-1,this.ceilCol=-1,this.floorTex=-1,this.ceilTex=-1}addSprite(t){this.sprites.push(t)}use(t,e){return!1}tick(){for(let t=0;t<this.sprites.length;t++){const e=this.sprites[t];e.tick(),e.removed&&this.sprites.splice(t--,1)}}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&this.entities.splice(e,1)}addEntity(t){this.entities.push(t)}blocks(t){return this.blocksMotion}decorate(t,e,s){}getFloorHeight(t){return 0}getWalkSpeed(t){return 1}getFriction(t){return.6}trigger(t){}}e.Block=o,o.random=new i.Random},5004:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChestBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.open=!1,this.tex=1,this.blocksMotion=!0,this.chestSprite=new i.Sprite(0,0,0,16,i.Art.getCol(16776960)),this.addSprite(this.chestSprite)}use(t,e){return!this.open&&(this.chestSprite.tex++,this.open=!0,t.getLoot(this.id),i.Sound.treasure().play(),!0)}}e.ChestBlock=o},8397:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DoorBlock=void 0;const i=s(6656);class o extends i.SolidBlock{constructor(){super(),this.open=!1,this.openness=0,this.tex=4,this.solidRender=!1}use(t,e){return this.open=!this.open,this.open?i.Sound.click1().play():i.Sound.click2().play(),!0}tick(){super.tick(),this.open?this.openness+=.2:this.openness-=.2,this.openness<0&&(this.openness=0),this.openness>1&&(this.openness=1);const t=7/8;this.openness<t&&!this.open&&!this.blocksMotion&&this.level.containsBlockingEntity(this.x-.5,this.y-.5,this.x+.5,this.y+.5)?this.openness=t:this.blocksMotion=this.openness<t}blocks(t){const e=7/8;return this.openness>=e&&t instanceof i.Player||this.openness>=e&&t instanceof i.Bullet?this.blocksMotion:!(this.openness>=e&&t instanceof i.OgreEntity)||this.blocksMotion}}e.DoorBlock=o},7468:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FinalUnlockBlock=void 0;const i=s(6656);class o extends i.SolidBlock{constructor(){super(),this.pressed=!1,this.tex=11}use(t,e){return!(this.pressed||this.level.player.keys<4||(i.Sound.click1().play(),this.pressed=!0,this.level.trigger(this.id,!0),0))}}e.FinalUnlockBlock=o},9061:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IceBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.blocksMotion=!1,this.floorTex=16}tick(){super.tick(),this.floorCol=i.Art.getCol(8421631)}getWalkSpeed(t){return t.getSelectedItem()===i.Item.skates?.05:1.4}getFriction(t){return t.getSelectedItem()===i.Item.skates?.98:1}blocks(t){return!(t instanceof i.Player||t instanceof i.Bullet||t instanceof i.EyeBossEntity||t instanceof i.EyeEntity)}}e.IceBlock=o},5906:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LadderBlock=void 0;const i=s(6656);class o extends i.Block{constructor(t){super(),t?(this.floorTex=1,this.addSprite(new i.Sprite(0,0,0,11,i.Art.getCol(o.LADDER_COLOR)))):(this.ceilTex=1,this.addSprite(new i.Sprite(0,0,0,12,i.Art.getCol(o.LADDER_COLOR))))}removeEntity(t){super.removeEntity(t),t instanceof i.Player&&(this.wait=!1)}addEntity(t){super.addEntity(t),!this.wait&&t instanceof i.Player&&(this.level.switchLevel(this.id),i.Sound.ladder().play())}}e.LadderBlock=o,o.LADDER_COLOR=14388819},3991:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LockedDoorBlock=void 0;const i=s(6656);class o extends i.DoorBlock{constructor(){super(),this.tex=5}use(t,e){return!1}trigger(t){this.open=t}}e.LockedDoorBlock=o},7124:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LootBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.taken=!1,this.sprite=new i.Sprite(0,0,0,18,i.Art.getCol(16777088)),this.addSprite(this.sprite),this.blocksMotion=!0}addEntity(t){super.addEntity(t),!this.taken&&t instanceof i.Player&&(this.sprite.removed=!0,this.taken=!0,this.blocksMotion=!1,t.loot++,i.Sound.pickup().play())}blocks(t){return!(t instanceof i.Player)&&this.blocksMotion}}e.LootBlock=o},8465:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PitBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.filled=!1,this.floorTex=1,this.blocksMotion=!0}addEntity(t){super.addEntity(t),!this.filled&&t instanceof i.BoulderEntity&&(t.remove(),this.filled=!0,this.blocksMotion=!1,this.addSprite(new i.Sprite(0,0,0,10,i.BoulderEntity.COLOR)),i.Sound.thud().play())}blocks(t){return!(t instanceof i.BoulderEntity)&&this.blocksMotion}}e.PitBlock=o},1874:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PressurePlateBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.pressed=!1,this.floorTex=2}tick(){super.tick();const t=.2,e=this.level.containsBlockingNonFlyingEntity(this.x-t,this.y-t,this.x+t,this.y+t);e!==this.pressed&&(this.pressed=e,this.pressed?this.floorTex=3:this.floorTex=2,this.level.trigger(this.id,this.pressed),this.pressed?i.Sound.click1().play():i.Sound.click2().play())}getFloorHeight(t){return this.pressed?-.02:.02}}e.PressurePlateBlock=o},1155:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SolidBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.solidRender=!0,this.blocksMotion=!0}}e.SolidBlock=o},8668:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SpiritWallBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.floorTex=7,this.ceilTex=7,this.blocksMotion=!0;for(let t=0;t<6;t++){const t=Math.random()-.5,e=.3*(Math.random()-.7),s=Math.random()-.5;this.addSprite(new i.Sprite(t,e,s,38+i.Block.random.nextInt(2),i.Art.getCol(2105376)))}}blocks(t){return!(t instanceof i.Bullet)&&super.blocks(t)}}e.SpiritWallBlock=o},5666:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SwitchBlock=void 0;const i=s(6656);class o extends i.SolidBlock{constructor(){super(),this.pressed=!1,this.tex=2}use(t,e){return this.pressed=!this.pressed,this.pressed?this.tex=3:this.tex=2,t.trigger(this.id,this.pressed),this.pressed?i.Sound.click1().play():i.Sound.click2().play(),!0}}e.SwitchBlock=o},1956:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TorchBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.torchSprite=new i.Sprite(0,0,0,3,i.Art.getCol(16776960)),this.sprites.push(this.torchSprite)}decorate(t,e,s){const o=new i.Random(341871231*(e+1e3*s)),h=.4;for(let i=0;i<1e3;i++){const i=o.nextInt(4);if(0===i&&t.getBlock(e-1,s).solidRender){this.torchSprite.x-=h;break}if(1===i&&t.getBlock(e,s-1).solidRender){this.torchSprite.z-=h;break}if(2===i&&t.getBlock(e+1,s).solidRender){this.torchSprite.x+=h;break}if(3===i&&t.getBlock(e,s+1).solidRender){this.torchSprite.z+=h;break}}}tick(){super.tick(),0===i.Block.random.nextInt(4)&&(this.torchSprite.tex=3+i.Block.random.nextInt(2))}}e.TorchBlock=o},603:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VanishBlock=void 0;const i=s(6656);class o extends i.SolidBlock{constructor(){super(),this.gone=!1,this.tex=1}use(t,e){if(this.gone)return!1;this.gone=!0,this.blocksMotion=!1,this.solidRender=!1,i.Sound.crumble().play();for(let t=0;t<32;t++){const t=new i.RubbleSprite;t.col=this.col,this.addSprite(t)}return!0}}e.VanishBlock=o},3849:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WaterBlock=void 0;const i=s(6656);class o extends i.Block{constructor(){super(),this.steps=0,this.blocksMotion=!0}tick(){super.tick(),this.steps--,this.steps<=0&&(this.floorTex=8+i.Block.random.nextInt(3),this.floorCol=i.Art.getCol(255),this.steps=16)}blocks(t){return!(t instanceof i.Player&&t.getSelectedItem()===i.Item.flippers)&&!(t instanceof i.Bullet)&&this.blocksMotion}getFloorHeight(t){return-.5}getWalkSpeed(t){return.4}}e.WaterBlock=o},8788:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WinBlock=void 0;const i=s(6656);class o extends i.Block{addEntity(t){super.addEntity(t),t instanceof i.Player&&t.win()}}e.WinBlock=o},5150:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CryptLevel=void 0;const i=s(6656);class o extends i.Level{constructor(){super(),this.floorCol=4210752,this.ceilCol=4210752,this.wallCol=4210752,this.name="The Crypt"}switchLevel(t){1===t&&this.game.switchLevel("overworld",2)}getLoot(t){super.getLoot(t),1===t&&this.game.getLoot(i.Item.flippers)}}e.CryptLevel=o},308:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DungeonLevel=void 0;const i=s(6656);class o extends i.Level{constructor(){super(),this.wallCol=12994900,this.floorCol=9325137,this.ceilCol=9325137,this.name="The Dungeons"}init(t,e,s,i,o){super.init(t,e,s,i,o),super.trigger(6,!0),super.trigger(7,!0)}switchLevel(t){1===t&&this.game.switchLevel("start",2)}getLoot(t){super.getLoot(t),1===t&&this.game.getLoot(i.Item.powerGlove)}trigger(t,e){super.trigger(t,e),5===t&&super.trigger(6,!e),4===t&&super.trigger(7,!e)}}e.DungeonLevel=o},2895:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IceLevel=void 0;const i=s(6656);class o extends i.Level{constructor(){super(),this.floorCol=12114912,this.ceilCol=12114912,this.wallCol=7071999,this.name="The Frost Cave"}switchLevel(t){1===t&&this.game.switchLevel("overworld",5)}getLoot(t){super.getLoot(t),1===t&&this.game.getLoot(i.Item.skates)}}e.IceLevel=o},8667:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(o,h){function r(t){try{l(i.next(t))}catch(t){h(t)}}function n(t){try{l(i.throw(t))}catch(t){h(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,n)}l((i=i.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Level=void 0;const h=s(6656),r=o(s(6693)),n=o(s(4843)),l=o(s(3412)),a=o(s(9330)),c=o(s(9575)),d=o(s(9763));class u{constructor(){this.blocks=[],this.solidWall=new h.SolidBlock,this.wallCol=11783906,this.floorCol=10264731,this.ceilCol=10264731,this.wallTex=0,this.floorTex=0,this.ceilTex=0,this.entities=[],this.name=""}init(t,e,s,i,o){this.game=t,this.player=t.player,this.solidWall.col=h.Art.getCol(this.wallCol),this.solidWall.tex=h.Art.getCol(this.wallTex),this.width=s,this.height=i,this.blocks=new Array(this.width*this.height);for(let t=0;t<i;t++)for(let e=0;e<s;e++){const i=16777215&o[e+t*s],r=255-(o[e+t*s]>>24&255),n=this.getBlock(e,t,i);n.id=r,-1===n.tex&&(n.tex=this.wallTex),-1===n.floorTex&&(n.floorTex=this.floorTex),-1===n.ceilTex&&(n.ceilTex=this.ceilTex),-1===n.col&&(n.col=h.Art.getCol(this.wallCol)),-1===n.floorCol&&(n.floorCol=h.Art.getCol(this.floorCol)),-1===n.ceilCol&&(n.ceilCol=h.Art.getCol(this.ceilCol)),this.blocks[e+t*s]=n,n.level=this,n.x=e,n.y=t}for(let t=0;t<i;t++)for(let e=0;e<s;e++){const i=16777215&o[e+t*s];this.decorateBlock(e,t,this.blocks[e+t*s],i)}}addEntity(t){this.entities.push(t),t.level=this,t.updatePos()}removeEntityImmediately(t){const e=this.entities.indexOf(t);e>-1&&this.entities.splice(e,1),this.getBlock(t.xTileO,t.zTileO).removeEntity(t)}decorateBlock(t,e,s,i){s.decorate(this,t,e),16776960===i&&(this.xSpawn=t,this.ySpawn=e),11162880===i&&this.addEntity(new h.BoulderEntity(t,e)),16711680===i&&this.addEntity(new h.BatEntity(t,e)),16711681===i&&this.addEntity(new h.BatBossEntity(t,e)),16711682===i&&this.addEntity(new h.OgreEntity(t,e)),16711683===i&&this.addEntity(new h.BossOgre(t,e)),16711684===i&&this.addEntity(new h.EyeEntity(t,e)),16711685===i&&this.addEntity(new h.EyeBossEntity(t,e)),16711686===i&&this.addEntity(new h.GhostEntity(t,e)),16711687===i&&this.addEntity(new h.GhostBossEntity(t,e)),1712392!==i&&16711687!==i||(s.floorTex=7,s.ceilTex=7),13027014===i&&(s.col=h.Art.getCol(10526880)),13026967===i&&(s.col=h.Art.getCol(10526880)),6633984===i&&(s.floorCol=h.Art.getCol(11888128),s.floorTex=25),9699227===i&&(s.col=h.Art.getCol(2797363),s.tex=8)}getBlock(t,e,s){return void 0===s?t<0||e<0||t>=this.width||e>=this.height?this.solidWall:this.blocks[t+e*this.width]:9699227===s?new h.SolidBlock:37632===s?new h.PitBlock:16777215===s?new h.SolidBlock:65535===s?new h.VanishBlock:16777060===s?new h.ChestBlock:255===s?new h.WaterBlock:16726530===s?new h.TorchBlock:5000268===s?new h.BarsBlock:16738047===s?new h.LadderBlock(!1):10354846===s?new h.LadderBlock(!0):12697933===s?new h.LootBlock:13027014===s?new h.DoorBlock:65447===s?new h.SwitchBlock:37760===s?new h.PressurePlateBlock:16711685===s||4144992===s?new h.IceBlock:13026967===s?new h.LockedDoorBlock:16759298===s?new h.AltarBlock:7639847===s?new h.SpiritWallBlock:1712392===s?new h.Block:49831===s?new h.FinalUnlockBlock:86===s?new h.WinBlock:new h.Block}static clear(){u.loaded.clear()}static loadBitmap(t){return i(this,void 0,void 0,(function*(){const e=new Image,s=document.createElement("canvas").getContext("2d");e.src=t,yield e.decode(),s.drawImage(e,0,0);const i=new h.Bitmap(e.naturalWidth,e.naturalHeight),o=s.getImageData(0,0,e.naturalWidth,e.naturalHeight).data;for(let t=0;t<o.length;t+=4)i.pixels[t/4]=o[t+3]<<24|o[t]<<16|o[t+1]<<8|o[t+2];return i}))}static loadLevel(t,e){if(this.loaded.has(e))return this.loaded.get(e);let s;"crypt"===e&&(s=u.crypt),"dungeon"===e&&(s=u.dungeon),"ice"===e&&(s=u.ice),"overworld"===e&&(s=u.overworld),"start"===e&&(s=u.start),"temple"===e&&(s=u.temple);const i=s.width,o=s.height,h=u.byName(e);return h.init(t,e,i,o,s.pixels),this.loaded.set(e,h),h}static byName(t){return"crypt"===t?new h.CryptLevel:"dungeon"===t?new h.DungeonLevel:"ice"===t?new h.IceLevel:"overworld"===t?new h.OverworldLevel:"start"===t?new h.StartLevel:"temple"===t?new h.TempleLevel:void 0}containsBlockingEntity(t,e,s,i){const o=Math.trunc(Math.floor((s+t)/2)),h=Math.trunc(Math.floor((i+e)/2));for(let r=h-2;r<=h+2;r++)for(let h=o-2;h<=o+2;h++){const o=this.getBlock(h,r).entities;for(let h=0;h<o.length;h++)if(o[h].isInside(t,e,s,i))return!0}return!1}containsBlockingNonFlyingEntity(t,e,s,i){const o=Math.trunc(Math.floor((s+t)/2)),h=Math.trunc(Math.floor((i+e)/2));for(let r=h-2;r<=h+2;r++)for(let h=o-2;h<=o+2;h++){const o=this.getBlock(h,r).entities;for(let h=0;h<o.length;h++){const r=o[h];if(!r.flying&&r.isInside(t,e,s,i))return!0}}return!1}tick(){for(let t=0;t<this.entities.length;t++){const e=this.entities[t];e.tick(),e.updatePos(),e.isRemoved()&&this.entities.splice(t--,1)}for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)this.blocks[e+t*this.width].tick()}trigger(t,e){for(let s=0;s<this.height;s++)for(let i=0;i<this.width;i++){const o=this.blocks[i+s*this.width];o.id===t&&o.trigger(e)}}findSpawn(t){for(let e=0;e<this.height;e++)for(let s=0;s<this.width;s++){const i=this.blocks[s+e*this.width];i.id===t&&i instanceof h.LadderBlock&&(this.xSpawn=s,this.ySpawn=e)}}getLoot(t){20===t&&this.game.getLoot(h.Item.pistol),21===t&&this.game.getLoot(h.Item.potion)}win(){this.game.win(this.player)}lose(){this.game.lose(this.player)}showLootScreen(t){this.game.setMenu(new h.GotLootMenu(t))}}e.Level=u,u.crypt=new h.Bitmap(0,0),u.dungeon=new h.Bitmap(0,0),u.ice=new h.Bitmap(0,0),u.overworld=new h.Bitmap(0,0),u.start=new h.Bitmap(0,0),u.temple=new h.Bitmap(0,0),u.loadBitmap(r.default).then((t=>u.crypt=t)),u.loadBitmap(n.default).then((t=>u.dungeon=t)),u.loadBitmap(l.default).then((t=>u.ice=t)),u.loadBitmap(a.default).then((t=>u.overworld=t)),u.loadBitmap(c.default).then((t=>u.start=t)),u.loadBitmap(d.default).then((t=>u.temple=t)),u.loaded=new Map},9275:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OverworldLevel=void 0;const i=s(6656);class o extends i.Level{constructor(){super(),this.ceilTex=-1,this.floorCol=5276243,this.floorTex=24,this.wallCol=10526880,this.name="The Island"}switchLevel(t){1===t&&this.game.switchLevel("start",1),2===t&&this.game.switchLevel("crypt",1),3===t&&this.game.switchLevel("temple",1),5===t&&this.game.switchLevel("ice",1)}getLoot(t){super.getLoot(t),1===t&&this.game.getLoot(i.Item.cutters)}}e.OverworldLevel=o},5791:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StartLevel=void 0;const i=s(6656);class o extends i.Level{constructor(){super(),this.name="The Prison"}decorateBlock(t,e,s,i){super.decorateBlock(t,e,s,i)}getBlock(t,e,s){return super.getBlock(t,e,s)}switchLevel(t){1===t&&this.game.switchLevel("overworld",1),2===t&&this.game.switchLevel("dungeon",1)}getLoot(t){super.getLoot(t)}}e.StartLevel=o},3021:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TempleLevel=void 0;const i=s(6656);class o extends i.Level{constructor(){super(),this.triggerMask=0,this.floorCol=9069718,this.ceilCol=9069718,this.wallCol=13610459,this.name="The Temple"}switchLevel(t){1===t&&this.game.switchLevel("overworld",3)}getLoot(t){super.getLoot(t),1===t&&this.game.getLoot(i.Item.skates)}trigger(t,e){this.triggerMask|=1<<t,e||(this.triggerMask^=1<<t),14===this.triggerMask?super.trigger(1,!0):super.trigger(1,!1)}}e.TempleLevel=o},8519:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(6656);class o{constructor(){this.renderer=new i.Renderer(o.WIDTH,o.HEIGHT,o.SCALE),this.frames=0,this.tickCount=0,this.unprocessedMilisseconds=0,this.milissecondsPerFrame=1e3/60,this.game=new i.Game,this.inputHandler=new i.InputHandler,this.screen=new i.Screen(o.WIDTH,o.HEIGHT),this.loop()}loop(t){const e=t-this.lastTime||0;for(this.lastTime=t,requestAnimationFrame(this.loop.bind(this)),this.unprocessedMilisseconds+=e;this.unprocessedMilisseconds>this.milissecondsPerFrame;)this.tick(),this.tickCount++,this.tickCount%60==0&&(console.log(`${this.frames} fps`),this.frames=0),this.unprocessedMilisseconds-=this.milissecondsPerFrame;this.render()}tick(){this.game.tick(this.inputHandler.keys)}render(){this.screen.render(this.game,!0),this.renderer.drawScreen(this.screen),this.frames++}}o.WIDTH=160,o.HEIGHT=120,o.SCALE=4,window.onload=()=>{new o}},1932:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AboutMenu=void 0;const i=s(6656);class o extends i.Menu{constructor(){super(...arguments),this.tickDelay=30}render(t){t.fill(0,0,160,120,0),t.drawString("About",60,8,i.Art.getCol(16777215));const e=["Prelude of the Chambered","by Markus Persson.","Made Aug 2011 for the","21'st Ludum Dare compo.","","This game is freeware,","and was made from scratch","in just 48 hours."];for(let s=0;s<e.length;s++)t.drawString(e[s],4,28+8*s,i.Art.getCol(10526880));0===this.tickDelay&&t.drawString("-> Continue",40,t.height-16,i.Art.getCol(16777088))}tick(t,e,s,o,h,r){this.tickDelay>0?this.tickDelay--:r&&(i.Sound.click1().play(),t.setMenu(new i.TitleMenu))}}e.AboutMenu=o},8143:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GotLootMenu=void 0;const i=s(6656);class o extends i.Menu{constructor(t){super(),this.tickDelay=30,this.item=t}render(t){let e=`You found the ${this.item.name}!`;t.scaleDraw(i.Art.items,3,t.width/2-24,2,16*this.item.icon,0,16,16,i.Art.getCol(this.item.color)),t.drawString(e,(t.width-6*e.length)/2+2,50,i.Art.getCol(16777088)),e=this.item.description,t.drawString(e,(t.width-6*e.length)/2+2,60,i.Art.getCol(10526880)),0===this.tickDelay&&t.drawString("-> Continue",40,t.height-40,i.Art.getCol(16777088))}tick(t,e,s,i,o,h){this.tickDelay>0?this.tickDelay--:h&&t.setMenu(null)}}e.GotLootMenu=o},7027:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InstructionsMenu=void 0;const i=s(6656);class o extends i.Menu{constructor(){super(...arguments),this.tickDelay=30}render(t){t.fill(0,0,160,120,0),t.drawString("Instructions",40,8,i.Art.getCol(16777215));const e=["Use W,A,S,D to move, and","the arrow keys to turn.","","The 1-8 keys select","items from the inventory","","Space uses items"];for(let s=0;s<e.length;s++)t.drawString(e[s],4,32+8*s,i.Art.getCol(10526880));0===this.tickDelay&&t.drawString("-> Continue",40,t.height-16,i.Art.getCol(16777088))}tick(t,e,s,o,h,r){this.tickDelay>0?this.tickDelay--:r&&(i.Sound.click1().play(),t.setMenu(new i.TitleMenu))}}e.InstructionsMenu=o},4837:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LoseMenu=void 0;const i=s(6656);class o extends i.Menu{constructor(t){super(),this.tickDelay=30,this.player=t}render(t){t.draw(i.Art.logo,0,10,0,39,160,23,i.Art.getCol(16777215));let e=Math.trunc(this.player.time/60);const s=Math.trunc(e/60);e%=60;let o=`${s}:`;e<10&&(o+="0"),o+=e,t.drawString(`Trinkets: ${this.player.loot}/12`,40,45,i.Art.getCol(9474192)),t.drawString(`Time: ${o}`,40,55,i.Art.getCol(9474192)),0===this.tickDelay&&t.drawString("-> Continue",40,t.height-40,i.Art.getCol(16777088))}tick(t,e,s,o,h,r){this.tickDelay>0?this.tickDelay--:r&&(i.Sound.click1().play(),t.setMenu(new i.TitleMenu))}}e.LoseMenu=o},1991:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Menu=void 0,e.Menu=class{}},4774:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PauseMenu=void 0;const i=s(6656);class o extends i.Menu{constructor(){super(...arguments),this.options=["Abort game","Continue"],this.selected=1}render(t){t.draw(i.Art.logo,0,8,0,0,160,36,i.Art.getCol(16777215));for(let e=0;e<this.options.length;e++){let s=this.options[e],o=9474192;this.selected===e&&(s=`-> ${s}`,o=16777088),t.drawString(s,40,60+10*e,i.Art.getCol(o))}}tick(t,e,s,o,h,r){(e||s)&&i.Sound.click2().play(),e&&this.selected--,s&&this.selected++,this.selected<0&&(this.selected=0),this.selected>=this.options.length&&(this.selected=this.options.length-1),r&&(i.Sound.click1().play(),0===this.selected&&t.setMenu(new i.TitleMenu),1===this.selected&&t.setMenu(null))}}e.PauseMenu=o},9518:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TitleMenu=void 0;const i=s(6656);class o extends i.Menu{constructor(){super(...arguments),this.options=["New game","Instructions","About"],this.selected=0,this.firstTick=!0}render(t){t.fill(0,0,160,120,0),t.draw(i.Art.logo,0,8,0,0,160,36,i.Art.getCol(16777215));for(let e=0;e<this.options.length;e++){let s=this.options[e],o=9474192;this.selected===e&&(s=`-> ${s}`,o=16777088),t.drawString(s,40,60+10*e,i.Art.getCol(o))}t.drawString("Copyright (C) 2011 Mojang",5,111,i.Art.getCol(3158064))}tick(t,e,s,o,h,r){this.firstTick&&(this.firstTick=!1,i.Sound.altar().play()),(e||s)&&i.Sound.click2().play(),e&&this.selected--,s&&this.selected++,this.selected<0&&(this.selected=0),this.selected>=this.options.length&&(this.selected=this.options.length-1),r&&(i.Sound.click1().play(),0===this.selected?(t.setMenu(null),t.newGame()):1===this.selected?t.setMenu(new i.InstructionsMenu):2===this.selected&&t.setMenu(new i.AboutMenu))}}e.TitleMenu=o},2195:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WinMenu=void 0;const i=s(6656);class o extends i.Menu{constructor(t){super(),this.tickDelay=30,this.player=t}render(t){t.draw(i.Art.logo,0,10,0,65,160,23,i.Art.getCol(16777215));let e=Math.trunc(this.player.time/60);const s=Math.trunc(e/60);e%=60;let o=`${s}:`;e<10&&(o+="0"),o+=e,t.drawString(`Trinkets: ${this.player.loot}/12`,40,45,i.Art.getCol(9474192)),t.drawString(`Time: ${o}`,40,55,i.Art.getCol(9474192)),0===this.tickDelay&&t.drawString("-> Continue",40,t.height-40,i.Art.getCol(16777088))}tick(t,e,s,o,h,r){this.tickDelay>0?this.tickDelay--:r&&(i.Sound.click1().play(),t.setMenu(new i.TitleMenu))}}e.WinMenu=o},6656:function(t,e,s){var i=this&&this.__createBinding||(Object.create?function(t,e,s,i){void 0===i&&(i=s);var o=Object.getOwnPropertyDescriptor(e,s);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,i,o)}:function(t,e,s,i){void 0===i&&(i=s),t[i]=e[s]}),o=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||i(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),o(s(5717),e),o(s(9963),e),o(s(1761),e),o(s(1814),e),o(s(3588),e),o(s(2623),e),o(s(4848),e),o(s(1120),e),o(s(548),e),o(s(8519),e),o(s(7278),e),o(s(3419),e),o(s(4664),e),o(s(2202),e),o(s(654),e),o(s(4282),e),o(s(9317),e),o(s(3308),e),o(s(2110),e),o(s(882),e),o(s(9808),e),o(s(4103),e),o(s(7460),e),o(s(6421),e),o(s(8642),e),o(s(913),e),o(s(1110),e),o(s(1991),e),o(s(1932),e),o(s(8143),e),o(s(7027),e),o(s(4837),e),o(s(4774),e),o(s(9518),e),o(s(2195),e),o(s(8667),e),o(s(5150),e),o(s(308),e),o(s(2895),e),o(s(9275),e),o(s(5791),e),o(s(3021),e),o(s(2732),e),o(s(1155),e),o(s(8711),e),o(s(5286),e),o(s(5004),e),o(s(8397),e),o(s(7468),e),o(s(9061),e),o(s(5906),e),o(s(3991),e),o(s(7124),e),o(s(8465),e),o(s(1874),e),o(s(8668),e),o(s(5666),e),o(s(1956),e),o(s(603),e),o(s(3849),e),o(s(8788),e),o(s(7769),e)},9963:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Random=void 0,e.Random=class{constructor(t){this.seed=1,this.maxInt=Math.pow(2,32),void 0!==t&&(this.seed=3*t)}random(){const t=1e4*Math.sin(this.seed++);return t-Math.floor(t)}nextInt(t){return Math.trunc(this.random()*(t||this.maxInt))}nextGaussian(){return this.random()}}},3419:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0,e.Renderer=class{constructor(t,e,s){this.width=t,this.height=e,this.scale=s,this.canvas=document.getElementById("game"),this.canvas.width=this.width*s,this.canvas.height=this.height*s,this.ctx=this.canvas.getContext("2d"),this.image=this.ctx.createImageData(this.width,this.height)}drawScreen(t){for(let e=0;e<t.pixels.length;e++)this.image.data.set([(16711680&t.pixels[e])>>16,(65280&t.pixels[e])>>8,255&t.pixels[e],255],4*e);this.render()}render(){const t=this.ctx.createImageData(this.image.width*this.scale,this.image.height*this.scale),e=this.ctx.createImageData(this.scale,1).data;for(let s=0;s<this.image.height;s++)for(let i=0;i<this.image.width;i++){const o=this.image.data.subarray(4*(s*this.image.width+i),4*(s*this.image.width+i)+4);for(let t=0;t<this.scale;t++)e.set(o,4*t);for(let o=0;o<this.scale;o++){const h=s*this.scale+o,r=i*this.scale;t.data.set(e,4*(h*t.width+r))}}this.ctx.putImageData(t,0,0)}}},1761:function(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Sound=void 0;const o=i(s(9618)),h=i(s(4503)),r=i(s(6907)),n=i(s(7037)),l=i(s(9342)),a=i(s(6568)),c=i(s(3309)),d=i(s(7346)),u=i(s(58)),p=i(s(3444)),f=i(s(2097)),y=i(s(9569)),g=i(s(1969)),m=i(s(4835)),w=i(s(6232)),v=i(s(2569)),k=i(s(8084)),x=i(s(8914)),M=i(s(4498)),B=i(s(4210)),S=i(s(8436));class b{}e.Sound=b,b.altar=()=>new Audio(o.default),b.bosskill=()=>new Audio(h.default),b.click1=()=>new Audio(r.default),b.click2=()=>new Audio(n.default),b.hit=()=>new Audio(d.default),b.hurt=()=>new Audio(u.default),b.hurt2=()=>new Audio(p.default),b.kill=()=>new Audio(y.default),b.death=()=>new Audio(c.default),b.splash=()=>new Audio(M.default),b.key=()=>new Audio(f.default),b.pickup=()=>new Audio(m.default),b.roll=()=>new Audio(v.default),b.shoot=()=>new Audio(k.default),b.treasure=()=>new Audio(S.default),b.crumble=()=>new Audio(l.default),b.slide=()=>new Audio(x.default),b.cut=()=>new Audio(a.default),b.thud=()=>new Audio(B.default),b.ladder=()=>new Audio(g.default),b.potion=()=>new Audio(w.default)}},e={};function s(i){var o=e[i];if(void 0!==o)return o.exports;var h=e[i]={exports:{}};return t[i].call(h.exports,h,h.exports,s),h.exports}s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),s(8519)})();